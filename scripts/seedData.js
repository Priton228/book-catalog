const { Client } = require('pg');
require('dotenv').config();

async function seedDatabase() {
    const client = new Client({
        user: process.env.DB_USER,
        host: process.env.DB_HOST,
        database: process.env.DB_NAME,
        password: process.env.DB_PASSWORD,
        port: process.env.DB_PORT,
    });

    try {
        await client.connect();
        console.log('📊 Подключение к базе данных...');

        // Добавляем жанры
        console.log('📚 Добавляем жанры...');
        const genres = await client.query(`
            INSERT INTO genres (name, description) VALUES
            ('Классическая литература', 'Произведения классиков мировой литературы'),
            ('Фэнтези', 'Фантастические произведения с элементами волшебства'),
            ('Научная фантастика', 'Фантастические произведения на научной основе'),
            ('Детектив', 'Произведения о расследовании преступлений'),
            ('Роман', 'Художественные произведения о любви и отношениях'),
            ('Приключения', 'Захватывающие приключенческие истории'),
            ('Ужасы', 'Страшные и мистические произведения'),
            ('Биография', 'Книги о реальных людях и событиях')
            ON CONFLICT (name) DO NOTHING
            RETURNING id, name
        `);

        // Добавляем авторов
        console.log('✍️ Добавляем авторов...');
        const authors = await client.query(`
            INSERT INTO authors (name, biography) VALUES
            ('Лев Толстой', 'Великий русский писатель, мыслитель, философ. Участник обороны Севастополя. Просветитель, публицист, религиозный мыслитель.'),
            ('Федор Достоевский', 'Русский писатель, мыслитель, философ и публицист. Член-корреспондент Петербургской академии наук.'),
            ('Джордж Оруэлл', 'Английский писатель и публицист. Наиболее известен как автор культового антиутопического романа «1984».'),
            ('Дж. К. Роулинг', 'Британская писательница, сценаристка и кинопродюсер, наиболее известная как автор серии романов о Гарри Поттере.'),
            ('Стивен Кинг', 'Американский писатель, работающий в разнообразных жанрах, включая ужасы, триллер, фантастику, фэнтези, мистику.'),
            ('Агата Кристи', 'Английская писательница. Относится к числу самых известных в мире авторов детективной прозы.'),
            ('Дэн Браун', 'Американский писатель, журналист, музыкант. Известен своими романами в жанре криптоисторического детективного триллера.'),
            ('Айзек Азимов', 'Американский писатель-фантаст, популяризатор науки, биохимик. Автор около 500 книг.')
            ON CONFLICT DO NOTHING
            RETURNING id, name
        `);

        // Добавляем книги
        console.log('📖 Добавляем книги...');
        await client.query(`
            INSERT INTO books (title, author_id, genre_id, isbn, publisher, publication_year, price, stock_quantity, description) VALUES
            ('Война и мир', 1, 1, '978-5-17-112558-3', 'АСТ', 1869, 25.99, 10, 'Роман-эпопея, описывающий русское общество в эпоху войн против Наполеона в 1805—1812 годах.'),
            ('Анна Каренина', 1, 1, '978-5-04-103852-7', 'Эксмо', 1877, 18.50, 8, 'Роман о трагической любви замужней женщины Анны Карениной и блестящего офицера Вронского.'),
            ('Преступление и наказание', 2, 1, '978-5-04-103389-8', 'Эксмо', 1866, 15.75, 12, 'Роман о бывшем студенте Родионе Раскольникове, совершившем убийство.'),
            ('1984', 3, 3, '978-5-17-080115-2', 'АСТ', 1949, 14.99, 15, 'Антиутопический роман о тоталитарном обществе под постоянным контролем «Старшего Брата».'),
            ('Скотный двор', 3, 3, '978-5-17-087625-9', 'АСТ', 1945, 12.50, 20, 'Сатирическая повесть-притча о животных, восставших против фермера.'),
            ('Гарри Поттер и философский камень', 4, 2, '978-5-389-07435-4', 'Махаон', 1997, 22.99, 25, 'Первая книга серии о юном волшебнике Гарри Поттере.'),
            ('Гарри Поттер и Тайная комната', 4, 2, '978-5-389-07436-1', 'Махаон', 1998, 23.50, 18, 'Вторая книга о приключениях Гарри Поттера в Хогвартсе.'),
            ('Оно', 5, 7, '978-5-17-080115-3', 'АСТ', 1986, 19.99, 7, 'Роман ужасов о древнем зле, терроризирующем город Дерри.'),
            ('Сияние', 5, 7, '978-5-17-087623-5', 'АСТ', 1977, 17.75, 9, 'История писателя Джека Торренса, ставшего смотрителем отеля «Оверлук».'),
            ('Убийство в «Восточном экспрессе»', 6, 4, '978-5-699-87654-3', 'Эксмо', 1934, 13.25, 14, 'Знаменитый детектив Эркюля Пуаро расследует убийство в поезде.'),
            ('Десять негритят', 6, 4, '978-5-04-103852-8', 'Эксмо', 1939, 12.99, 11, 'Детектив о десяти незнакомцах, приглашенных на остров и умирающих по стишку.'),
            ('Код да Винчи', 7, 4, '978-5-699-87654-4', 'Эксмо', 2003, 16.50, 22, 'Детективный триллер о расследовании убийства в Лувре.'),
            ('Ангелы и демоны', 7, 4, '978-5-699-87654-5', 'Эксмо', 2000, 15.75, 19, 'Роман о противостоянии иллюминатов и Ватикана.'),
            ('Я, робот', 8, 3, '978-5-699-87654-6', 'Эксмо', 1950, 11.99, 13, 'Сборник научно-фантастических рассказов о роботах и трех законах робототехники.'),
            ('Основание', 8, 3, '978-5-699-87654-7', 'Эксмо', 1951, 13.25, 8, 'Первый роман знаменитого цикла о Галактической Империи.')
            ON CONFLICT DO NOTHING
        `);

        // Добавляем администратора
        console.log('👑 Создаем администратора...');
        const bcrypt = require('bcryptjs');
        const adminPassword = await bcrypt.hash('admin123', 10);
        const userPassword = await bcrypt.hash('user123', 10);

        await client.query(`
            INSERT INTO users (email, password_hash, full_name, role) 
            VALUES 
            ('admin@bookstore.com', $1, 'Администратор Системы', 'admin'),
            ('user@example.com', $2, 'Иван Иванов', 'customer'),
            ('petr@example.com', $2, 'Петр Петров', 'customer')
            ON CONFLICT (email) DO NOTHING
        `, [adminPassword, userPassword]);

        console.log('✅ Тестовые данные успешно добавлены!');
        console.log('');
        console.log('📋 Информация для тестирования:');
        console.log('👤 Администратор: admin@bookstore.com / admin123');
        console.log('👤 Пользователь:  user@example.com / user123');
        console.log('👤 Пользователь:  petr@example.com / user123');
        console.log('');
        console.log('📚 Добавлено: 8 жанров, 8 авторов, 15 книг, 3 пользователя');

    } catch (error) {
        console.error('❌ Ошибка при добавлении тестовых данных:', error);
    } finally {
        await client.end();
    }
}

seedDatabase();
